<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>647 Universe – 性能分析</title>
    <link>https://bwangel.me/docs/performance/</link>
    <description>Recent content in 性能分析 on 647 Universe</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>cn</language>
    <lastBuildDate>Sun, 13 Aug 2023 16:17:47 +0800</lastBuildDate>
    
	  <atom:link href="https://bwangel.me/docs/performance/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Docs: QPS 和 RT 的关系</title>
      <link>https://bwangel.me/docs/performance/qps_rt/</link>
      <pubDate>Sun, 13 Aug 2023 16:17:52 +0800</pubDate>
      
      <guid>https://bwangel.me/docs/performance/qps_rt/</guid>
      <description>
        
        
        &lt;h2 id=&#34;术语说明&#34;&gt;术语说明&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;QPS: Query Per Second&lt;/li&gt;
&lt;li&gt;RT: Response Time&lt;/li&gt;
&lt;li&gt;RT_CPU: 单个请求中的 CPU 时间&lt;/li&gt;
&lt;li&gt;RT_WAIT: 单个请求中除了 CPU 时间外的其他时间(等待时间)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;结论&#34;&gt;结论&lt;/h2&gt;
&lt;p&gt;单线程情况下, &lt;code&gt;QPS = 1000 / RT&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;多线程情况下，最好的情况(最佳线程数)是&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;QPS = 1000 / RT_CPU&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;最佳线程数 = (RT_CPU+RT_WAIT) / RT_CPU * CPU核心&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;线程数超过 最佳线程数 后, 系统的 QPS 不会再增加了，如果进一步增多，因为多个线程抢夺 CPU 资源导致的时间浪费，QPS 还会下降。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;说明&#34;&gt;说明&lt;/h2&gt;
&lt;p&gt;一个请求我们除了有 CPU 执行时间外，还有等待时间(等待IO/等待锁资源)。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果单个请求的等待时间占比很高，我们可以增加线程数，提升 CPU 的利用率，这样 QPS 也会随之增加。(CPU 利用率达到 85% 以上才比较正常)
&lt;ul&gt;
&lt;li&gt;线程本身也会消耗资源，它消耗的是 OS 级别的内存，不是进程内存，如果线程数小于 1000, 那么对于系统性能的影响可以忽略不计。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如果单个请求的 CPU 时间占比很高，此时 CPU 成为系统瓶颈，那么系统整体的 QPS 已经没有提升空间了，要么优化程序，减少 CPU 指令数，要么增加 CPU 资源。&lt;/li&gt;
&lt;li&gt;我们提升系统 QPS 的目的就是提升 CPU 的利用率，使 CPU 成为系统瓶颈。&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: Latency</title>
      <link>https://bwangel.me/docs/performance/latency/</link>
      <pubDate>Tue, 19 Dec 2023 18:51:09 +0800</pubDate>
      
      <guid>https://bwangel.me/docs/performance/latency/</guid>
      <description>
        
        
        &lt;h2 id=&#34;latency-comparison-numbers-2012&#34;&gt;Latency Comparison Numbers (~2012)&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Operation&lt;/th&gt;
&lt;th&gt;ns&lt;/th&gt;
&lt;th&gt;µs&lt;/th&gt;
&lt;th&gt;ms&lt;/th&gt;
&lt;th&gt;note&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;L1 cache reference&lt;/td&gt;
&lt;td&gt;0.5 ns&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Branch mispredict&lt;/td&gt;
&lt;td&gt;5 ns&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L2 cache reference&lt;/td&gt;
&lt;td&gt;7 ns&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;14x L1 cache&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mutex lock/unlock&lt;/td&gt;
&lt;td&gt;25 ns&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Main memory reference&lt;/td&gt;
&lt;td&gt;100 ns&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;20x L2 cache, 200x L1 cache&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Compress 1K bytes with Zippy&lt;/td&gt;
&lt;td&gt;3,000 ns&lt;/td&gt;
&lt;td&gt;3 µs&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Send 1K bytes over 1 Gbps network&lt;/td&gt;
&lt;td&gt;10,000 ns&lt;/td&gt;
&lt;td&gt;10 µs&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 4K randomly from SSD*&lt;/td&gt;
&lt;td&gt;150,000 ns&lt;/td&gt;
&lt;td&gt;150 µs&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;~1GB/sec SSD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from memory&lt;/td&gt;
&lt;td&gt;250,000 ns&lt;/td&gt;
&lt;td&gt;250 µs&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Round trip within same datacenter&lt;/td&gt;
&lt;td&gt;500,000 ns&lt;/td&gt;
&lt;td&gt;500 µs&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from SSD*&lt;/td&gt;
&lt;td&gt;1,000,000 ns&lt;/td&gt;
&lt;td&gt;1,000 µs&lt;/td&gt;
&lt;td&gt;1 ms&lt;/td&gt;
&lt;td&gt;~1GB/sec SSD, 4X memory&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Disk seek&lt;/td&gt;
&lt;td&gt;10,000,000 ns&lt;/td&gt;
&lt;td&gt;10,000 µs&lt;/td&gt;
&lt;td&gt;10 ms&lt;/td&gt;
&lt;td&gt;20x datacenter roundtrip&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from disk&lt;/td&gt;
&lt;td&gt;20,000,000 ns&lt;/td&gt;
&lt;td&gt;20,000 µs&lt;/td&gt;
&lt;td&gt;20 ms&lt;/td&gt;
&lt;td&gt;80x memory, 20X SSD&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Send packet CA -&amp;gt; Netherlands -&amp;gt; CA&lt;/td&gt;
&lt;td&gt;150,000,000 ns&lt;/td&gt;
&lt;td&gt;150,000 µs&lt;/td&gt;
&lt;td&gt;150 ms&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;notes&#34;&gt;Notes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;1 ns = 10^-9 seconds&lt;/li&gt;
&lt;li&gt;1 us = 10^-6 seconds = 1,000 ns&lt;/li&gt;
&lt;li&gt;1 ms = 10^-3 seconds = 1,000 us = 1,000,000 ns&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;credit&#34;&gt;Credit&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;By Jeff Dean:               &lt;a href=&#34;http://research.google.com/people/jeff/&#34;&gt;http://research.google.com/people/jeff/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Originally by Peter Norvig: &lt;a href=&#34;http://norvig.com/21-days.html#answers&#34;&gt;http://norvig.com/21-days.html#answers&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;contributions&#34;&gt;Contributions&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&amp;lsquo;Humanized&amp;rsquo; comparison:  &lt;a href=&#34;https://gist.github.com/hellerbarde/2843375&#34;&gt;https://gist.github.com/hellerbarde/2843375&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Visual comparison chart: &lt;a href=&#34;http://i.imgur.com/k0t1e.png&#34;&gt;http://i.imgur.com/k0t1e.png&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
